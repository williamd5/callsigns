<!DOCTYPE html>
<html lang="en">
<head>
  <title>Callsign text to speech</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://www.cloudianos.com/src/ci-pro/style.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://code.responsivevoice.org/responsivevoice.js?key=WGciAW2s"></script>
</head>
<body>

<div class="jumbotron text-center">
  <h1>Callsign text to speech</h1>
  <p>This project transcripts airline ICAO codes. Powered by ResponsiveVoice.</p> 
</div>

<div class="container">
  <div class="row">
    <div class="col-sm-4">
      <div class="input-group">
        <label for="callsign" class="mb-0"><b>Callsign</b></label>
        <div class="input-group mb-3">
          <input type="text" class="form-control" placeholder="BAW749" id="callsign">
          <div class="input-group-append">
            <button class="btn btn-primary" type="button" onclick="toCallsign()">Go</button>
          </div>
        </div>
      </div>
    </div>
    <div class="col-sm-8">
      <h3>BAW 749</h3>
      <p class="lead"><span class="text align-middle">SPEEDBIRD SEVEN FOUR NINER</span><button class="btn btn-secondary btn-sm ml-3 align-middle"><i class="ci-pro ci-volume_up" onclick="speak()"></i></button></p>
    </div>
  </div>
</div>
<script>
let callsigns = {}, alphabet = {};
$(document).ready(function () {
  $.get({
    url: "/callsigns/callsigns.json",
    success: function (data) {
      callsigns = data; 
    }
  });
  $.get({
    url: "/callsigns/alphabet.json",
    success: function (data) {
      alphabet = data; 
    }
  });
});
  
$("#callsign").on('input', toCallsign);

function speak() {
  responsiveVoice.speak($(".lead .text").html(), "UK English Female", {rate: 1.2}); 
}
  
function toCallsign () {
  let input = $("#callsign").val().replace(" ", "").toUpperCase();
  let callsign = input.split(/\d/)[0];
  let numbers = input.substr(callsign.length);
  let telephony = callsigns[callsign];
  let phonetic = [];
  for (let i in numbers) phonetic.push(toPhonetic(numbers[i]));
  phonetic = phonetic.join(" ");
  let full = telephony + " " + phonetic;
  console.log(phonetic, full);
  $("h3").html(callsign + " " + numbers);
  $(".lead .text").html(full);
}
  
function toPhonetic (data) {
  data = data.toUpperCase();
  if (alphabet[data] !== undefined) return alphabet[data];
  return data;
}
</script>
</body>
</html>
