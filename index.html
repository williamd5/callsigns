<!DOCTYPE html>
<html lang="en">
<head>
  <title>Callsign text to speech</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://www.cloudianos.com/src/ci-pro/style.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://code.responsivevoice.org/responsivevoice.js?key=WGciAW2s"></script>
  <script>var config = {"welcomeMessage":false,"speakSelectedText":false,"speakLinks":false,"speakInactivity":false,"speakEndPage":false,"exitIntent":false,"accesibilityNavigation":false,"accesibilityNavigation2":false,"welcomeMessageTime":false,"text_welcomeMessage":"Welcome to Responsiv Voice. Voice enable your website or app in minutes.","text_speakInactivity":"","text_speakEndPage":"","text_exitIntent":"","trackEvents":false,"abTesting":false,"analytics_id":null,"another_field":null};</script>
</head>
<body>

<div class="jumbotron text-center">
  <h1>Callsign text to speech</h1>
  <p>This project transcripts airline ICAO codes. Powered by ResponsiveVoice.</p> 
</div>

<div class="container">
  <div class="row mb-5">
    <div class="col-sm-4">
      <div class="input-group">
        <label for="callsign" class="mb-0"><b>Callsign</b></label>
        <div class="input-group mb-3">
          <input type="text" class="form-control" placeholder="BAW749" id="callsign">
          <div class="input-group-append">
            <button class="btn btn-success" type="button" onclick="$('#callsign').val(genCallsign());toCallsign()">Generate</button>
            <button class="btn btn-primary" type="button" onclick="toCallsign()">Go</button>
          </div>
        </div>
      </div>
    </div>
    <div class="col-sm-8">
      <h3>BAW 749</h3>
      <p class="lead"><span class="text align-middle">SPEEDBIRD SEVEN FOUR NINER</span><button class="btn btn-secondary btn-sm ml-3 align-middle" onclick="speak()"><i class="ci-pro ci-volume_up"></i></button></p>
    </div>
  </div>
  <textarea id="text" placeholder="Type any text here" class="form-control mb-2"></textarea>
  <button class="btn btn-primary" onclick="speakText()">Speak</button>
</div>
<script>
let callsigns = {}, alphabet = {};
$(document).ready(function () {
  $.get({
    url: "https://williamd5.github.io/callsigns/callsigns.json",
    success: function (data) {
      callsigns = data; 
    }
  });
  $.get({
    url: "https://williamd5.github.io/callsigns/alphabet.json",
    success: function (data) {
      alphabet = data; 
    }
  });
});
  
$("#callsign").on('input', toCallsign);

function speak() {
  responsiveVoice.speak($(".lead .text").html(), "UK English Female", {rate: 1.2}); 
}
  
function toCallsign () {
  let input = $("#callsign").val().replace(" ", "").toUpperCase();
  let callsign = input.substr(0, 3);
  let numbers = input.substr(callsign.length);
  let telephony = "";
  if (callsigns[callsign]) telephony = callsigns[callsign];
  else for (let i in callsign) telephony += toPhonetic(callsign[i]) + " ";
  let phonetic = [];
  for (let i in numbers) phonetic.push(toPhonetic(numbers[i]));
  phonetic = phonetic.join(" ");
  let full = telephony.toUpperCase() + " " + phonetic;
  console.log(phonetic, full);
  $("h3").html(callsign + " " + numbers);
  $(".lead .text").html(full);
}
  
function toPhonetic (data) {
  data = data.toUpperCase();
  if (alphabet[data] !== undefined) return alphabet[data];
  return data;
}
  
  function genCallsign () {
    var designators = Object.keys(callsigns);
    let designator = designators[Math.floor(Math.random() * designators.length)];

    let numbers = '';
    let characters = 'ABCDEFGHJKLMNPQRSTUVWXYZ0123456789012345678901234567890123456789012345678901234567890123456789';
    let length = rand(1, 4);
    for (let i = 0; i < length; ++i) numbers += characters[Math.floor(Math.random() * characters.length)];

    return designator + numbers;
}

function rand(min, max) {
    min = Math.ceil(min);
    max = Math.floor(max);
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

function speakText() {
	let input = $("#text").val().toUpperCase();
	let text = [];
    for (let i in input) text.push(toPhonetic(input[i]));
    text = text.join(" ");
    responsiveVoice.speak(text, "UK English Female");
}
</script>
</body>
</html>
